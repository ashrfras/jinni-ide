/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/@webcontainer/api@1.1.8/dist/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
function e(n){const r={d:{}};for(const s of Object.keys(n)){const i=n[s];if("file"in i){const e=i.file.contents,n="string"==typeof e?e:t(e),o="string"==typeof e?{}:{b:!0};r.d[s]={f:{c:n,...o}};continue}const o=e(i.directory);r.d[s]=o}return r}function t(e){let t="";for(const n of e)t+=String.fromCharCode(n);return t}var n=Object.defineProperty,r={};((e,t)=>{for(var r in t)n(e,r,{get:t[r],enumerable:!0})})(r,{createEndpoint:()=>i,expose:()=>u,proxy:()=>y,proxyMarker:()=>s,releaseProxy:()=>o,transfer:()=>_,transferHandlers:()=>l,windowEndpoint:()=>g,wrap:()=>p});var s=Symbol("Comlink.proxy"),i=Symbol("Comlink.endpoint"),o=Symbol("Comlink.releaseProxy"),a=Symbol("Comlink.thrown"),c=e=>"object"==typeof e&&null!==e||"function"==typeof e,l=new Map([["proxy",{canHandle:e=>c(e)&&e[s],serialize(e){const{port1:t,port2:n}=new MessageChannel;return u(e,t),[n,[n]]},deserialize:e=>(e.start(),p(e))}],["throw",{canHandle:e=>c(e)&&a in e,serialize({value:e}){let t;return t=e instanceof Error?{isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:{isError:!1,value:e},[t,[]]},deserialize(e){if(e.isError)throw Object.assign(new Error(e.value.message),e.value);throw e.value}}]]);function u(e,t=self){t.addEventListener("message",(function n(r){if(!r||!r.data)return;const{id:s,type:i,path:o}=Object.assign({path:[]},r.data),c=(r.data.argumentList||[]).map(v);let l;try{const t=o.slice(0,-1).reduce(((e,t)=>e[t]),e),n=o.reduce(((e,t)=>e[t]),e);switch(i){case 0:l=n;break;case 1:t[o.slice(-1)[0]]=v(r.data.value),l=!0;break;case 2:l=n.apply(t,c);break;case 3:l=y(new n(...c));break;case 4:{const{port1:t,port2:n}=new MessageChannel;u(e,n),l=_(t,[t])}break;case 5:l=void 0}}catch(e){l={value:e,[a]:0}}Promise.resolve(l).catch((e=>({value:e,[a]:0}))).then((e=>{const[r,o]=b(e);t.postMessage(Object.assign(Object.assign({},r),{id:s}),o),5===i&&(t.removeEventListener("message",n),h(t))}))})),t.start&&t.start()}function h(e){(function(e){return"MessagePort"===e.constructor.name})(e)&&e.close()}function p(e,t){return f(e,[],t)}function d(e){if(e)throw new Error("Proxy has been released and is not useable")}function f(e,t=[],n=function(){}){let r=!1;const s=new Proxy(n,{get(n,i){if(d(r),i===o)return()=>E(e,{type:5,path:t.map((e=>e.toString()))}).then((()=>{h(e),r=!0}));if("then"===i){if(0===t.length)return{then:()=>s};const n=E(e,{type:0,path:t.map((e=>e.toString()))}).then(v);return n.then.bind(n)}return f(e,[...t,i])},set(n,s,i){d(r);const[o,a]=b(i);return E(e,{type:1,path:[...t,s].map((e=>e.toString())),value:o},a).then(v)},apply(n,s,o){d(r);const a=t[t.length-1];if(a===i)return E(e,{type:4}).then(v);if("bind"===a)return f(e,t.slice(0,-1));const[c,l]=w(o);return E(e,{type:2,path:t.map((e=>e.toString())),argumentList:c},l).then(v)},construct(n,s){d(r);const[i,o]=w(s);return E(e,{type:3,path:t.map((e=>e.toString())),argumentList:i},o).then(v)}});return s}function w(e){const t=e.map(b);return[t.map((e=>e[0])),(n=t.map((e=>e[1])),Array.prototype.concat.apply([],n))];var n}var m=new WeakMap;function _(e,t){return m.set(e,t),e}function y(e){return Object.assign(e,{[s]:!0})}function g(e,t=self,n="*"){return{postMessage:(t,r)=>e.postMessage(t,n,r),addEventListener:t.addEventListener.bind(t),removeEventListener:t.removeEventListener.bind(t)}}function b(e){for(const[t,n]of l)if(n.canHandle(e)){const[r,s]=n.serialize(e);return[{type:3,name:t,value:r},s]}return[{type:0,value:e},m.get(e)||[]]}function v(e){switch(e.type){case 3:return l.get(e.name).deserialize(e.value);case 0:return e.value}}function E(e,t,n){return new Promise((r=>{const s=new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-");e.addEventListener("message",(function t(n){n.data&&n.data.id&&n.data.id===s&&(e.removeEventListener("message",t),r(n.data))})),e.start&&e.start(),e.postMessage(Object.assign({id:s},t),n)}))}const P="https://stackblitz.com/headless";let k=null,x=null,S={};const C=new TextDecoder,L=new TextEncoder;class A{_instance;_runtimeInfo;fs;static _instance=null;_tornDown=!1;constructor(e,t,n){this._instance=e,this._runtimeInfo=n,this.fs=new I(t)}async spawn(e,t,n){let r,s=[];Array.isArray(t)?s=t:n=t;let i=new ReadableStream;if(!1!==n?.output){const e=function(){let e=null;const t=new ReadableStream({start(t){e=t}});return{stream:t,push:t=>{null!=t?e?.enqueue(t):(e?.close(),e=null)}}}();r=e.push,i=e.stream}const o=z(function(e){if(null==e)return;return t=>{t instanceof Uint8Array?e(C.decode(t)):null==t&&e(null)}}(r)),a=await this._instance.run({command:e,args:s,env:n?.env,terminal:n?.terminal},void 0,void 0,o);return new j(a,i)}on(e,t){let n=!1,s=()=>{};return this._instance.on(e,r.proxy(((...e)=>{n||t(...e)}))).then((e=>{s=e,n&&s()})),()=>{n=!0,s()}}mount(t,n){const s=t instanceof Uint8Array?t:L.encode(JSON.stringify(e(t)));return this._instance.loadFiles(r.transfer(s,[s.buffer]),{mountPoints:n?.mountPoint})}get path(){return this._runtimeInfo.path}get workdir(){return this._runtimeInfo.cwd}teardown(){if(this._tornDown)throw new Error("WebContainer already torn down");this._tornDown=!0,this.fs._teardown(),this._instance.teardown(),this._instance[r.releaseProxy](),A._instance===this&&(A._instance=null)}static async boot(e={}){const{workdirName:t}=e;if(window.crossOriginIsolated&&"none"===e.coep&&console.warn("A Cross-Origin-Embedder-Policy header is required in cross origin isolated environments.\nSet the 'coep' option to 'require-corp'."),t?.includes("/")||".."===t||"."===t)throw new Error("workdirName should be a valid folder name");for(;k;)await k;if(A._instance)throw new Error("Only a single WebContainer instance can be booted");const n=async function(e){const{serverPromise:t}=function(e){if(null!=x)return e.coep!==S.coep&&(console.warn(`Attempting to boot WebContainer with 'coep: ${e.coep}'`),console.warn(`First boot had 'coep: ${S.coep}', new settings will not take effect!`)),{serverPromise:x};const t=document.createElement("iframe");t.style.display="none",t.setAttribute("allow","cross-origin-isolated");const n=new URL(window.WEBCONTAINER_API_IFRAME_URL??P);n.searchParams.set("version","1.1.8"),e.coep&&n.searchParams.set("coep",e.coep);t.src=n.toString();const{origin:s}=n;return S={...e},x=new Promise((e=>{const t=t=>{if(t.origin!==s)return;const{data:n}=t;"init"!==n.type?"warning"!==n.type||console[n.level].call(console,n.message):e(r.wrap(t.ports[0]))};window.addEventListener("message",t)})),document.body.insertBefore(t,null),{serverPromise:x}}(e),n=await t,s=await n.build({host:window.location.host,version:"1.1.8",workdirName:e.workdirName}),i=await s.fs(),o=await s.runtimeInfo();return new A(s,i,o)}(e);k=n.catch((()=>{}));try{const e=await n;return A._instance=e,e}finally{k=null}}}class O{name;_type;constructor(e,t){this.name=e,this._type=t}isFile(){return 1===this._type}isDirectory(){return 2===this._type}}class M{_apiClient;_path;_options;_listener;_wrappedListener;_watcher;_closed=!1;constructor(e,t,n,r){this._apiClient=e,this._path=t,this._options=n,this._listener=r,this._apiClient._watchers.add(this),this._wrappedListener=(e,t)=>{this._listener&&!this._closed&&this._listener(e,t)},this._apiClient._fs.watch(this._path,this._options,z(this._wrappedListener)).then((e=>{this._watcher=e,this._closed&&this._teardown()})).catch(console.error)}close(){this._closed||(this._closed=!0,this._apiClient._watchers.delete(this),this._teardown())}_teardown(){this._watcher?.close().finally((()=>{this._watcher?.[r.releaseProxy]()}))}}class j{output;input;exit;_process;constructor(e,t){this.output=t,this._process=e,this.input=new WritableStream({write:e=>{this._getProcess()?.write(e).catch((()=>{}))}}),this.exit=this._onExit()}kill(){this._getProcess()?.kill()}resize(e){this._getProcess()?.resize(e)}async _onExit(){try{return await this._process.onExit}finally{this._process?.[r.releaseProxy](),this._process=null}}_getProcess(){return null==this._process&&console.warn("This process already exited"),this._process}}class I{_fs;_watchers=new Set([]);constructor(e){this._fs=e}rm(...e){return this._fs.rm(...e)}async readFile(e,t){return await this._fs.readFile(e,t)}async rename(e,t){return await this._fs.rename(e,t)}async writeFile(e,t,n){if(t instanceof Uint8Array){const e=t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);t=r.transfer(new Uint8Array(e),[e])}await this._fs.writeFile(e,t,n)}async readdir(e,t){const n=await this._fs.readdir(e,t);if("string"==typeof n[0])return n;if(function(e){return e[0]instanceof Uint8Array}(n))return n;return n.map((e=>new O(e.name,e["Symbol(type)"])))}async mkdir(e,t){return await this._fs.mkdir(e,t)}watch(e,t,n){return"function"==typeof t&&(n=t,t=null),new M(this,e,t,n)}_teardown(){this._fs[r.releaseProxy]();for(const e of this._watchers)e.close()}}function z(e){if(null!=e)return r.proxy(e)}export{A as WebContainer};export default null;
//# sourceMappingURL=/sm/e029d8cdb87c787a2a6584bfabe5fc94a02f3ff56d5e0c58edd5d3a83683435a.map