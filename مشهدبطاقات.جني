ئورد مكون، عنصرمخصص، عنصرئدخال، عنصر، عنصرئشتمل؛
ئورد حدت، حدتمخصص؛
ئورد النافدة من نافدة؛
ئورد المستند من مستند؛
ئورد سياق؛
ئورد نتجقاب، بتشدبي من مكون.بتشدبي؛
ئورد شبكي من مكون.شبكي؛
ئورد طافية من مكون.طافية؛
ئورد مكون.نعملا؛
ئورد مكون.غمازة؛
ئورد مشهدبطاقة، عنصربطاقة؛
ئورد قابمحلي من قاعدب؛
ئورد مختطبطاقة من صنفمجال.بطاقة؛
ئورد مختطوحدة من صنفمجال.وحدة؛
ئورد الكل ك مجالبطاقة من صنفمجال.بطاقة؛
ئورد الكل ك مجالوحدة من صنفمجال.وحدة؛
ئورد وضيفة؛


ئعلن مشهدبطاقات ()؛
ئعلن مشهدبطاقات.ردلون (مختطبطاقة بط) ك نصية؛
ئعلن مشهدبطاقات.ئغلاقبطاقة (نصية معرف) ك وعد؛
ئعلن مشهدبطاقات.صيير ()؛
ئعلن مشهدبطاقات.حممل () ك وعد؛
ئعلن مشهدبطاقات.عندنقرفتحبطاقة (عنصرئشتمل هدف) ك وعد؛
ئعلن مشهدبطاقات.عندنقرحدفوحدة (عنصرئشتمل هدف)؛
ئعلن مشهدبطاقات.عندحدفوحدة () ك وعد؛
ئعلن داعمحدتفتحوحدة (حدتمخصص ح) ك وضيفة؛
ئعلن مدخل ()؛

ئعلن مشهدبطاقات ():
	يمدد مكون()؛
	يملك مركب { مختطبطاقة[] بطاقات } حالة = {
		بطاقات: []
	}؛
	يملك مختطبطاقة[] ئاخرمفتوح = []؛
	يملك مختطبطاقة[] بطاخطئين = []؛
تم

ئعلن مشهدبطاقات.حممل () ك وعد:
	مختطبطاقة[] بط = ريتما مجالبطاقة.ردبطامشروع(قابمحلي)؛
	هدا.خدحالة({
		بطاقات: بط
	})؛
	هدا.ئضفمستمعحدت('نقروحدة'، داعمحدتفتحوحدة)؛
تم

ئعلن مشهدبطاقات.حددت ():
	هدا.حددتمشهد()؛
	هدا.ئربطحدتين()؛
	لكل بط في هدا.بطاخطئين:
		عنصربطاقة عنصر = هدا.ئستعلم("#_%{بط._معرف}")؛
		ئدا عنصر:
			عنصر.سمة['backgroundColor'] = '#b91c1c'؛
		تم
	تم
تم

ئعلن مشهدبطاقات.صيير ():
	مختطبطاقة بطاقة؛
	نصية طنافدة = "height:calc(100dvh - 140px)"؛
	منطق هلجني = (سياق.حالة.مساروحدتحالية == '') ئو (سياق.حالة.مساروحدتحالية.ينتهيب('.جني'))؛
	ئرجع (
		<شرط>
			<عند تحقق="هلجني">
				<قسم صنف="حشس-4 فائضس-مخفي فائضص-تلقا خلف-حيادي-900">
					<قسم سمة="%{طنافدة};touch-action:pan-y">
						<شبكي عموصغ="2" عموسط="3" عموكب="4" فجوة="8 10" ماسنري="">
							<تكرار لكل="بطاقة" في="هدا.حالة.بطاقات">
								<عنصربطاقة style="background-color:%{هدا.ردلون\(بطاقة\)}" صنف="مخطط-طولي فجوة-1 حشتح-4 مقوسكج ئطار1 حشس-3 ئطار-رمادي-600 تئشير:ضلملتف رمادي-500 ط-محتوا" معرف="_%{بطاقة._معرف}" عندنقر="عندنقرفتحبطاقة" بيا-معرف="%{بطاقة._معرف}" عنوانبطا="%{بطاقة.عنوان}" نوعبطا="%{بطاقة.نوعبطاقة}" وحدة="%{بطاقة.وحدة}" محتوا="%{بطاقة.محتوا.قططع\(0، 100\).قللمنهاية\(\) + '...'}"></عنصربطاقة>
							</تكرار>
						</شبكي>
					</قسم>
				</قسم>
			</عند>
			<عند غيره>
				<قسم سمة="%{طنافدة}" صنف="مخطط-طولي ط-كامل ئصفف-وسط ئرصف-وسط فجوة-2">
					<حيز صنف="نصصجج ئبيض ئرتف-سطر-واسع:هام">ليست وحدة جني</حيز>
					<قسم صنف="مخطط-عرضي فجوة-4">
						<رابط عنونت="/ئختبر%{سياق.حالة.مساروحدتحالية}" صنف="نصصجج ئحمر-700" download>نززل</رابط>
						<رابط عنونت="#" عندنقر="عندنقرحدفوحدة" صنف="مئشر-سبابة نصصجج ئحمر-700">ئحدف</رابط>
					</قسم>
				</قسم>
			</عند>
		</شرط>
		
		<طافية معرف="طافبطاقة" عنصر-بطاقة="خلف-حيادي-900" صنف="داكن" حجم="ملئ" تابتة></طافية>
	)؛
تم

ئعلن مشهدبطاقات.خدبطاخطئين (مختطبطاقة[] بطاخطئين):
	هدا.بطاخطئين = بطاخطئين؛
	لكل بط في بطاخطئين:
		عنصربطاقة عنصر = هدا.ئستعلم("#_%{بط._معرف}")؛
		ئدا عنصر:
			عنصر.سمة['backgroundColor'] = '#b91c1c'؛
		تم
	تم
تم

ئعلن مشهدبطاقات.ردلون (مختطبطاقة بط) ك نصية:
	ئدا بط.عنوان == 'مدخل':
		ئرجع '#0c625d'؛
	تم
	ئدا (بط.نوعبطاقة == 'وضيفة') وو (ليس بط.عنوان.يتضمن('.')) وو ((بط.محتوا.يتضمن('يملك')) ئو (بط.محتوا.يتضمن('يمدد')) ئو بط.محتوا.يتضمن('يختصر')):
		ئرجع '#264d3b'؛
	تم
	ئدا بط.نوعبطاقة == 'ئوردين':
		ئرجع '#256377'؛
	تم
	ئدا بط.نوعبطاقة == 'ترويسة':
		ئرجع '#7c4a03'؛
	تم
	ئدا بط.نوعبطاقة == 'متغيرين':
		ئرجع '#472e5b'؛
	تم
	ئدا بط.نوعبطاقة == 'مركبين':
		ئرجع '#6c394f'؛
	تم
	ئدا بط.نوعبطاقة == 'تعدادين':
		ئرجع '#6c394f'؛
	تم	
	ئرجع ''؛
تم

ئعلن داعمحدتحفضبطاقة () ك وضيفة:
	مشهدبطاقات مشهب = المستند.ئستعلم((<مشهدبطاقات>))؛
	مشهب.ئطلقحدت(حدتمخصص('حفضبطاقة'))؛
تم

ئعلن داعمحدتفتحوحدة (حدتمخصص ح) ك وضيفة:
	ح.ئمنعمفترض()؛
	مشهدبطاقات مشهب = المستند.ئستعلم((<مشهدبطاقات>))؛
	مشهب.ئطلقحدت(حدتمخصص('ئفتحوحدة'، {
		بيا: ح.بيا
	}))؛
تم

ئعلن مشهدبطاقات.ئغلاقبطاقة (نصية معرف) ك وعد:
	مشهدبطاقة مشهبط = المستند.ئستعلم((<مشهدبطاقة>))؛
	مختطبطاقة بطاقتي = ريتما قابمحلي.ئجلب(معرف)؛
	عنصربطاقة عنصربطا = هدا.ئستعلم("#_%{معرف}")؛
	ئدا عنصربطا:
		عنصربطا.خدحالة({
			بطاقة: بطاقتي
		})؛
	تم
	مشهبط.ئحدفمستمعحدت('حفضبطاقة'، داعمحدتحفضبطاقة)؛
	مشهبط.ئحدفمستمعحدت('ئفتحوحدة'، داعمحدتفتحوحدة)؛
	هدا.ئطلقحدت(حدتمخصص('ئغلاقبطاقة'، {يتصاعد: صحيح}))؛
تم

ئعلن مشهدبطاقات.عندنقرفتحبطاقة (عنصرئشتمل هدف، حدت ح) ك وعد:
	ئدا ح.هدف.ئسمصنف.يتضمن('سطروحدة'):
		ئرجع؛
	تم
	مشهدبطاقة مشهبط = المستند.ئستعلم((<مشهدبطاقة>))؛
	نصية معرفبطاقة = هدف.ردخاصية('بيا-معرف')؛
	مختطبطاقة بطاقتي = ريتما قابمحلي.ئجلب(معرفبطاقة)؛
	هدا.ئاخرمفتوح = هدا.ئاخرمفتوح.رششح(دالة(بط): بط._معرف لا= معرفبطاقة)؛
	هدا.ئاخرمفتوح.ئستزح(بطاقتي)؛
	
	هدا.ئطلقحدت(حدتمخصص('فتحبطاقة'، {يتصاعد: صحيح}))؛
	
	مشهبط.خدحالة({
		ضاهر: صحيح،
		بطاقة: بطاقتي
	})؛
	مشهبط.ئضفمستمعحدت('حفضبطاقة'، داعمحدتحفضبطاقة)؛
	مشهبط.ئضفمستمعحدت('ئغلاقبطاقة'، دالة(): هدا.ئغلاقبطاقة(معرفبطاقة))؛
	مشهبط.ئضفمستمعحدت('ئنشائوحدة'، دالة(): هدا.ئطلقحدت(حدتمخصص('ئنشائوحدة')))؛
	مشهبط.ئضفمستمعحدت('ئفتحوحدة'، داعمحدتفتحوحدة)؛
تم

ئعلن مشهدبطاقات.عندنقرحدفوحدة (عنصرئشتمل هدف):
	نعملا نعل = المستند.ئستعلم((<نعملا>))؛
	نعل.خدحالة({
		رسالة: 'هل متئكد من رغبتك في حدف هده الوحدة نهائيا؟'،
		زرنعم: 'ئحدف'،
		زرلا: 'ئلغي'،
		ئيقو: 'معلو-دائرة'،
		عندنعم: هدا.عندحدفوحدة
	})؛
تم

ئعلن مشهدبطاقات.عندحدفوحدة () ك وعد:
	نصية مساروحدة = سياق.حالة.مساروحدتحالية؛
	غمازة غمز = المستند.ئستعلم((<غمازة>))؛
	مختطوحدة وح = ريتما قابمحلي.ئجلب(مساروحدة.عووض('/'، ''))؛
	ريتما مجالوحدة.ئحدف(قابمحلي، وح)؛
	غمز.خدحالة({
		رسالة: 'تم حدف الوحدة'
	})؛
	هدا.ئطلقحدت(حدتمخصص('حدفوحدة'))؛
	المستند.موقع.ئعدتحميل()؛
تم


ئعلن مدخل ():
	عنصرمخصص.سججل('مشهدبطاقات'، مشهدبطاقات)؛
تم