ئورد مكون، عنصرمخصص، عنصرئدخال، عنصر؛
ئورد رجكس؛
ئورد المستند من مستند؛
ئورد غمازة من مكون.غمازة؛
ئورد زر من مكون.زر؛
ئورد الكل ك جيتهب من جيتهب؛
ئورد الكل ك قاعدب من قاعدب؛
ئورد الئان من تاريخ؛
ئورد مختطمشروع، مختطوحدة، مختطبطاقة، ئنشئبطاقة، ئنشئوحدة من مختطة؛

ئعلن مركب _مدخصفحة:
	نصية رابط،
	نصية توكن،
	نصية مالك،
	نصية مستودع،
	نصية وصف،
	نصية نبدة،
	نصية ئسمشروع،
	نصية فرعمفترض
تم

ئعلن صفحمشجديد ():
	يمدد مكون()؛
	
	يملك مركب { عدد خطوة، نصية رسالتخطئ } حالة = {
		خطوة: 1،
		رسالتخطئ: ''
	}؛
	يملك _مدخصفحة مدخ = {
		رابط: ''،
		توكن: ''،
		مالك: ''،
		مستودع: ''،
		وصف: ''،
		نبدة: ''،
		ئسمشروع: ''،
		فرعمفترض: ''
	}؛
تم

ئعلن صفحمشجديد.صيير (): 
	ئرجع (
		<قسم صنف="مخطط-طولي ئصفف-وسط ئرصف-وسط فجوة-12 ط-كامل ع-شاشة خلف-ئسود">
		
			<قسم صنف="مخطط-عرضي ئرصف-وسط">
				<صورة مصدر="/ملفا/شعار.svg" عرض="120"></صورة>
			</قسم>
		
			<شرط>
				<عند تحقق="هدا.حالة.خطوة == 1">
					<قسم صنف="مخطط-طولي ع-96 فجوة-4">
						<حيز صنف="نصوسط نص-ئبيض نصصغ">ئدخل رابط المشروع علا جيتهب</حيز>
						<ئدخال معرف="ئدخرابط" نوع="نص" قيمة="_{هدا.مدخ.رابط}" ستنب="https://github.com/ashrfras/jinni" صنف="مقوس خلف-رمادي-700 نص-ئبيض منحيسار حشص-3"></ئدخال>
						<قسم صنف="مخطط-عرضي عنصرات-نهاية ئصفف-نهاية ئرصف-نهاية">
							<زر عندنقر="نقرتالي" نبرة="ئحمر-600" قيمة="التالي"></زر>
						
						</قسم>
					</قسم>
				</عند>
				
				<عند تحقق="هدا.حالة.خطوة == 2">
					<قسم صنف="مخطط-طولي ع-96 فجوة-4">
						<حيز صنف="نصوسط نص-ئبيض نصصغ">ئدخل <رابط عنونت="" صنف="ئحمر-600 تحتهسطر">توكن ولوج جيتهب</رابط></حيز>
						<ئدخال معرف="ئدختوكن" نوع="كلمتسر" ستنب="ghp_b9..." صنف="مقوس خلف-رمادي-700 نص-ئبيض منحيسار حشص-3"></ئدخال>
						<قسم صنف="مخطط-عرضي عنصرات-نهاية ئصفف-نهاية ئرصف-نهاية">
							<زر عندنقر="نقرتالي" نبرة="ئحمر-600" قيمة="التالي"></زر>
						</قسم>
					</قسم>
				</عند>
				
				<عند تحقق="هدا.حالة.خطوة == 3">
					<قسم صنف="مخطط-طولي ع-96 فجوة-4">
						<حيز صنف="نصوسط نص-ئبيض نصصغ">ئتمام معلومات المشروع</حيز>
						
						<قسم صنف="مخطط-عرضي ئصفف-بين ئرصف-بين">
							<قسم صنف="مخطط-طولي فجوة-1">
								<حيز صنف="نص-ئبيض نصصغ حشيم-1">ئسم جيتهب</حيز>
								<ئدخال ئسم="ئسمجيتهب" قيمة="_{هدا.مدخ.مستودع}" نوع="نص" صنف="ع-40 مقوس نص-ئبيض نصبداية حشص-3" معطل=""></ئدخال>
							</قسم>
							<قسم صنف="مخطط-طولي فجوة-1">
								<حيز صنف="نص-ئبيض نصصغ حشيم-1">ئسم جني</حيز>
								<ئدخال معرف="ئدخئسمجني" ستنب="ئسم بحرفين عربي" نوع="نص" صنف="ع-44 مقوس خلف-رمادي-700 نص-ئبيض نصبداية حشص-3"></ئدخال>
							</قسم>
						</قسم>
						
						<قسم صنف="مخطط-طولي فجوة-1">
							<حيز صنف="نص-ئبيض نصصغ حشيم-1">وصف جيتهب</حيز>
							<مربعنص ئسم="وصفجيتهب" نوع="نص" صنف="مقوس نصعادي منحيسار نص-ئبيض" معطل="">_{هدا.مدخ.وصف}</مربعنص>
						</قسم>
						
						<قسم صنف="مخطط-طولي فجوة-1">
							<حيز صنف="نص-ئبيض نصصغ حشيم-1">وصف جني</حيز>
							<مربعنص معرف="ئدخنبدة" ستنب="نبدة بحرفين عربي" نوع="نص" صنف="مقوس خلف-رمادي-700 نص-ئبيض"></مربعنص>
						</قسم>
						
						<قسم صنف="مخطط-عرضي عنصرات-نهاية ئصفف-نهاية ئرصف-نهاية هشفو-2">
							<زر عندنقر="نقرتالي" نبرة="ئحمر-600" قيمة="ئنشئ"></زر>
						</قسم>
						
					</قسم>
				</عند>
				
				<عند تحقق="هدا.حالة.خطوة == 4">
					<حيز معرف="حيزحالة" صنف="نصوسط نص-ئبيض نصصغ">يبدئ..</حيز>
				</عند>

			</شرط>
		
		</قسم>
		
		<قسم صنف="ئصفف-وسط ئرصف-وسط يخفرقن موضعمطلق تحت-3 نصوسط ع-شاشة">
			<صورة مصدر="/ملفا/رقمين.png" صنف="شفافية75" عرض="60"></صورة>
		</قسم>
	)؛
تم

ئعلن بطاقاتمنمحتوا (نصية معرفمشروع، نصية مساروحدة، نصية محتوا) ك مختطبطاقة[]:
	مختطبطاقة[] بطاقات = []؛
	
	ئدا مساروحدة.ينتهيب('.جني'):	
		رجكس رجئورد = رجكس('ئورد [^؛]+؛'، 'g')؛
		رجكس رجمتغ = رجكس('ئعلن [^؛(]+؛'، 'g')؛
		رجكس رجوضف = رجكس('ئعلن(?:(?!ئعلن)[\\s\\S])*تم'، 'g')؛
		
		نصية[] ئوردين = محتوا.طابق(رجئورد) ئو []؛
		نصية[] متغيرين = محتوا.طابق(رجمتغ) ئو []؛
		نصية[] وضيفات = محتوا.طابق(رجوضف) ئو []؛
		
		ئدا ئوردين.طول:
			بطاقات.ئدفع(ئنشئبطاقة(مساروحدة، ئوردين.ئدمج('\n')))؛
		تم
		ئدا متغيرين.طول:
			بطاقات.ئدفع(ئنشئبطاقة(مساروحدة، متغيرين.ئدمج('\n')))؛
		تم
		
		لكل طاوضف في وضيفات:
			ئدا طاوضف لا= '':
				بطاقات.ئدفع(ئنشئبطاقة(مساروحدة، طاوضف))؛
			تم
		تم
	وئلا:
		بطاقات.ئدفع(ئنشئبطاقة(مساروحدة، محتوا))؛
	تم
	
	ئرجع بطاقات؛
تم

ئعلن صفحمشجديد.حددت () ك وعد:
	هدا.حددتمشهد()؛
	هدا.ئربطحدتين()؛
	مكون غمازة = المستند.ئستعلم((<غمازة>))؛
	
	ئدا هدا.حالة.خطوة == 1:
		ئدا هدا.حالة.رسالتخطئ لا= '':
			غمازة.خدحالة({
				رسالة: هدا.حالة.رسالتخطئ
			})؛
			هدا.حالة.رسالتخطئ = ''؛
		تم
	تم
	
	ئدا هدا.حالة.خطوة == 4: # هنا ئرسائ المشروع
		عنصر حيزحالة = المستند.ردعنصربمعرف('حيزحالة')؛
		حيزحالة.ئشتملداخلي = 'يتحقق من المستودع..'؛
		مركب[] ملفات = ريتما جيتهب.ردجميعملفات(هدا.مدخ.توكن، هدا.مدخ.مالك، هدا.مدخ.مستودع، هدا.مدخ.فرعمفترض)؛
		ئدا ليس ملفات.بعضها(دالة (منوع عنصر): (عنصر['path'] ك نصية).يتضمن('.جني')):
			هدا.خدحالة({
				خطوة: 1،
				رسالتخطئ: 'هدا ليس مشروع جني'
			})؛
			ئرجع؛
		تم
		حيزحالة.ئشتملداخلي = 'يحممل الملفات..'؛
		#ئستبدائ القاعدب
		ريتما قاعدب.ئستبدئقاب()؛
		#ئستبدائ المشروع
		مختطمشروع مشروعي = {
			...هدا.مدخ،
			ئاخرفتح: الئان()،
			ئاخرتعديل: الئان()،
			ئاخرئيداع: الئان()،
			_معرف: 'مشروع' #البيئة تحتمل مشروع واحد
		}؛
		مختطوحدة[] وحدات = []؛
		مختطبطاقة[] بطاقات = []؛
		لكل ملف في ملفات:
			نصية محتوا = ريتما جيتهب.ردمحتواملف(هدا.مدخ.توكن، هدا.مدخ.مالك، هدا.مدخ.مستودع، ملف['path'])؛
			#ملف['محتوا'] = محتوا؛
			#ينشئ الوحدة
			دع مسار = ملف['path']؛
			مختطوحدة وحدتي = ئنشئوحدة(مسار)؛
			وحدات.ئدفع(وحدتي)؛
			#ينشئ البطاقات
			مختطبطاقة[] بطا = بطاقاتمنمحتوا(مشروعي._معرف، مسار، محتوا)؛
			بطاقات = [...بطاقات، ...بطا]؛
		تم

		ريتما قاعدب.ئستبدئمشروع(مشروعي، وحدات، بطاقات)؛
		حيزحالة.ئشتملداخلي = 'تمت بنجاح'؛
		المستند.موقع.ئعدتحميل()؛
	تم
تم

ئعلن صفحمشجديد.نقرتالي () ك وعد:
	مكون غمازة = المستند.ئستعلم((<غمازة>))؛
	
	ئدا هدا.حالة.خطوة == 1:
		نصية رابط = (المستند.ردعنصربمعرف('ئدخرابط') ك عنصرئدخال).قيمة؛
		ئدا ليس جيتهب.هلرابطصحيح(رابط):
			غمازة.خدحالة({
				رسالة: 'رابط غير صحيح'
			})؛
		وئلا:
			هدا.مدخ.رابط = رابط؛
			هدا.خدحالة({
				خطوة: 2
			})؛
		تم
		ئرجع؛
	تم
	
	ئدا هدا.حالة.خطوة == 2:
		نصية توكن = (المستند.ردعنصربمعرف('ئدختوكن') ك عنصرئدخال).قيمة؛
		مركب {نصية مالك، نصية مستودع، نصية وصف، نصية فرعمفترض} نتج = ريتما جيتهب.ردمعلومستودع(هدا.مدخ.رابط، توكن)؛
		ئدا ليس نتج:
			غمازة.خدحالة({
				رسالة: 'تم رفض الوصول، تحقق من التوكن'
			})؛
		وئلا:
			هدا.مدخ.توكن = توكن؛
			هدا.مدخ.مالك = نتج.مالك؛
			هدا.مدخ.مستودع = نتج.مستودع؛
			هدا.مدخ.وصف = نتج.وصف؛
			هدا.مدخ.فرعمفترض = نتج.فرعمفترض؛
			هدا.خدحالة({
				خطوة: 3
			})؛
		تم
		ئرجع؛
	تم
	
	ئدا هدا.حالة.خطوة == 3:
		نصية ئسمشروع = (المستند.ردعنصربمعرف('ئدخئسمجني') ك عنصرئدخال).قيمة؛
		نصية نبدة = المستند.ردعنصربمعرف('ئدخنبدة').ئشتملداخلي؛
		هدا.مدخ.ئسمشروع = ئسمشروع؛
		هدا.مدخ.نبدة = نبدة؛
		هدا.خدحالة({
			خطوة: 4
		})؛
	تم
تم

ئعلن مدخل ():
	عنصرمخصص.سججل('صفحمشجديد'، صفحمشجديد)؛
تم
