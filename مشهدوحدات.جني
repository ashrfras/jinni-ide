ئورد مكون، عنصرمخصص، عنصرئدخال، عنصر، عنصرئشتمل؛
ئورد رجكس، حدت، حدتمخصص؛
ئورد النافدة من نافدة؛
ئورد المستند من مستند؛

ئورد سياق؛

ئورد مكون.غمازة؛

ئورد نتجقاب، بتشدبي من مكون.بتشدبي؛
ئورد ئيقو من مكون.ئيقو؛
ئورد نعملا من مكون.نعملا؛

ئورد قابمحلي، ئستبدئقاب من قاعدب؛

ئورد مختطبطاقة من صنفمجال.بطاقة؛
ئورد مختطوحدة من صنفمجال.وحدة؛
ئورد مختطمشروع، مشروعحالي من صنفمجال.مشروع؛

ئورد الكل ك مجالوحدة من صنفمجال.وحدة؛
ئورد الكل ك مجالبطاقة من صنفمجال.بطاقة؛

ئورد مشهدبطاقات، مشهدمرشحات؛

ئعلن مشهدوحدات ():
	يمدد مكون()؛
	
	يملك عدد مهلة؛
	يملك منطق تمئطلاق؛
	يملك مركب {
		منطق ضاهر،
		مختطوحدة[] وحدات،
		نصية مساروحدتحالية،
		نصية[] مفتوحات
	} حالة = {
		ضاهر: خطئ،
		وحدات: []،
		مساروحدتحالية: عدم،
		مفتوحات: []
	}؛
تم

ئعلن مشهدوحدات.صييرمدخلة (مختطوحدة مدخلة، منطق هلحالية = خطئ، منطق هلمفتوح = خطئ) ك نصية:	
	نصية صنفوحدة = 'مئشر-سبابة حشيم-2 تئشير:خلف-حيادي-600 حشص-3'؛
	ئدا هلحالية:
		صنفوحدة = 'مئشر-فتراضي حشيم-2 خلف-ئحمر-700 حشص-3'؛
	تم
	
	مختطوحدة فرعية؛
	
	ئرجع (
		<قسم عندنقر="عندنقروحدة" بيا-مسار="%{مدخلة.مسار}" صنف="نقرطويل مخطط-عرضي فجوة-2 ئصفف-وسط %{صنفوحدة}">
			<شرط>
				<عند تحقق="مدخلة.نوعمدخلة == 'جني'">
					<ئيقو ئسم="مربع-قوس-كود" صنف="نصكجج"></ئيقو>
				</عند>
				<عند تحقق="\(مدخلة.نوعمدخلة == 'مجلد'\) وو ليس هلمفتوح">
					<ئيقو ئسم="مجلد" صنف="نصكجج"></ئيقو>
				</عند>
				<عند تحقق="\(مدخلة.نوعمدخلة == 'مجلد'\) وو هلمفتوح">
					<ئيقو ئسم="مجلد-زائد" صنف="نصكجج"></ئيقو>
				</عند>
				<عند غيره>
					<ئيقو ئسم="مربع-مساعدة" صنف="نصكجج"></ئيقو>
				</عند>
			</شرط>
			<حيز صنف="نص-ئبيض نصصج">%{مدخلة.مسارنسبي}</حيز>
		</قسم>
		
		<شرط>
			<عند تحقق="مدخلة.نوعمدخلة == 'مجلد'">
				<قسم معرف="وحدة%{مدخلة.مسار.عووض\('/'، ''\)}" صنف="حشيم-3 %{'بلوك' ئدا هلمفتوح وئلا 'بلاعرض'}">
					<تكرار لكل="فرعية" في="مدخلة.فرعيات">
						%{هدا.صييرمدخلة\(فرعية، فرعية.مسار == هدا.حالة.مساروحدتحالية، هدا.حالة.مفتوحات.يتضمن\(فرعية.مسار\)\)}
					</تكرار>
				</قسم>
			</عند>
		</شرط>
	)؛
تم

ئعلن مشهدوحدات.صيير ():
	نصية طنافدة = "height:_{النافدة.طولداخلي - 60}px"؛
	نصية فوق = "top:59px"؛
	نصية مرمخف = 'مرئي' ئدا هدا.حالة.ضاهر وئلا 'مخفي'؛
	مختطوحدة وحدتي؛
	ئرجع (
		<قسم صنف="حشيم-2 مخطط-طولي ط-كامل خلف-حيادي-900 ع-64 موضعتابت نص-ئسود ضلكب محورض-2000 %{مرمخف}" سمة="%{طنافدة};%{فوق}">
			<قسم معرف="قسمفائض" صنف="مخطط-طولي يكبر نص-ئبيض ع-كامل ط-كامل فائض-تلقا حشتح-2 حشفو-1 ئطارت1 ئطار-رمادي-700">
			
				<تكرار لكل="وحدتي" في="هدا.حالة.وحدات">
					%{هدا.صييرمدخلة\(وحدتي، وحدتي.مسار == هدا.حالة.مساروحدتحالية، هدا.حالة.مفتوحات.يتضمن\(وحدتي.مسار\)\)}
				</تكرار>
			
			</قسم>
			
			<قسم صنف="مخطط-طولي فجوة-1">
				<قسم صنف="مخطط-عرضي ئرصف-بين ئصفف-وسط نص-رمادي-300 حشص-3 حشس-4 ئطارت1 ئطار-رمادي-700">
					<قسم صنف="مخطط-طولي فجوة-1 نصصجج" سمة="line-height:1.2rem">
						<حيز>مشروع: %{مشروعحالي.ئسمشروع}</حيز>
						<حيز>مستودع: %{مشروعحالي.مستودع}</حيز>
					</قسم>
					<ئيقو عندنقر="نقرئغلقمشروع" ئسم="تسجيل-خروج" صنف="نصكجج مئشر-سبابة تئشير:نص-ئبيض"></ئيقو>
				</قسم>
				<حيز صنف="نصوسط نصصجج نص-رمادي-300">0.002</حيز>
			</قسم>
		</قسم>
		
		<نعملا صنف="داكن" نبرة="ئحمر-700" عنصر-عنوان="نصصغ" عنصر-رسالة="نصصج"></نعملا>
	)؛
تم

ئعلن مشهدوحدات.ئحدفوحدة (نصية معرفوحدة) ك وعد:
	غمازة غم = المستند.ئستعلم((<غمازة>))؛
	نصية مسار = معرفوحدة؛
	ئدا مسار.يبدئب('/'):
		مسار = مسار.عووض('/'، '')؛
	تم
	مختطوحدة وح = ريتما قابمحلي.ئجلب(مسار)؛
	# حدف البطاقات المرتبطة بالوحدة
	مختطبطاقة[] بطا = ريتما مجالبطاقة.بطاقاتمنوحدة(قابمحلي، وح.مسار)؛
	لكل بط في بطا:
		ريتما مجالبطاقة.ئحدف(قاب: قابمحلي، بط: بط، يحدفوحدة: خطئ)؛
	تم
	ريتما مجالوحدة.ئحدف(قابمحلي، وح)؛
	هدا.ئطلقحدت(حدتمخصص('حدفوحدة'، {يتصاعد: صحيح}))؛
	غم.خدحالة({
		رسالة: 'تم حدف الوحدة'
	})؛
تم

ئعلن مشهدوحدات.عندنقرطويل (عنصرئشتمل عنصر):
	هدا.تمئطلاق = صحيح؛
	نصية معرفوحدة = عنصر.ردخاصية('بيا-مسار')؛
	نعملا نعلا = هدا.ئستعلم((<نعملا>))؛
	نعلا.خدحالة({
		رسالة: 'هل متئكد من رغبتك في حدف هده الوحدة؟'،
		عندنعم: (دالة(): هدا.ئحدفوحدة(معرفوحدة))،
		ئيقو: 'خطر-دائرة'
	})؛
تم

ئعلن مشهدوحدات.بدئضغط (حدت ح، عنصرئشتمل ع):
	ح.ئمنعمفترض()؛
	هدا.تمئطلاق = خطئ؛
	هدا.مهلة = النافدة.خدمهلة(دالة(): هدا.عندنقرطويل(ع)، 1000)؛	
تم

ئعلن مشهدوحدات.ئمنعنقر (حدت ح):
	ئدا هدا.تمئطلاق:
		ح.ئوقفئنتشارمباشر()؛
		#ح.ئمنعمفترض()؛
	تم
تم

ئعلن مشهدوحدات.حددت ():
	عنصرئشتمل بفائض = هدا.ئستعلم('#قسمفائض')؛
	عدد مرئعلا = بفائض.مررئعلا؛
	هدا.حددتمشهد()؛
	هدا.ئربطحدتين()؛
	بفائض = هدا.ئستعلم('#قسمفائض')؛
	بفائض.مررئعلا = مرئعلا؛
	
	#النقر الطوير
	عنصرئشتمل[] نقرطويلين = هدا.ئستعلمكل('.نقرطويل')؛
	لكل عنصر في نقرطويلين:
		عنصر.ئضفمستمعحدت('ضغطمئشر'، دالة(حدت ح): هدا.بدئضغط(ح، عنصر))؛
		عنصر.ئضفمستمعحدت('بدايتلمس'، دالة(حدت ح): هدا.بدئضغط(ح، عنصر))؛
		
		عنصر.ئضفمستمعحدت('تركمئشر'، دالة(حدت ح): النافدة.ئمحومهلة(هدا.مهلة))؛
		عنصر.ئضفمستمعحدت('خروجمئشر'، دالة(حدت ح): النافدة.ئمحومهلة(هدا.مهلة))؛
		عنصر.ئضفمستمعحدت('نهايتلمس'، دالة(حدت ح): النافدة.ئمحومهلة(هدا.مهلة))؛
		
		عنصر.ئضفمستمعحدت('نقر'، دالة(حدت ح): هدا.ئمنعنقر(ح))؛
	تم
تم

ئعلن مشهدوحدات.حممل () ك وعد:
	مختطوحدة ئصل = ريتما مجالوحدة.ردشجرتوحدات(قابمحلي)؛

	هدا.خدحالة({
		وحدات: ئصل.فرعيات
	})؛
تم

ئعلن مشهدوحدات.ئغلقمشروع () ك وعد:
	ريتما ئستبدئقاب()؛
	النافدة.موقع.ئعدتحميل()؛
تم

ئعلن مشهدوحدات.نقرئغلقمشروع ():
	# تنبيه تم ئستبدائ القاعدب
	نعملا نعل = المستند.ئستعلم((<نعملا>))؛
	نعل.خدحالة({
		رسالة: 'ئغلاق المشروع يعني حدفه نهائيا من هدا الجهاز، تئكد من ئيداعك لجميع التعديلات.'،
		زرنعم: 'ئحدف'،
		زرلا: 'ئلغي'،
		ئيقو: 'معلو-دائرة'،
		عندنعم: هدا.ئغلقمشروع
	})؛
تم

ئعلن مشهدوحدات.عندنقروحدة (عنصرئشتمل هدف؟) ك وعد:
	نصية مساروحدة؛
	ئدا هدف:
		مساروحدة = هدف.ردخاصية('بيا-مسار')؛
	وئلا:
		مساروحدة = هدا.حالة.مساروحدتحالية؛
	تم
	ئدا ليس مساروحدة.يتضمن('.'): #وحدة مجلد
		عنصرئشتمل عنصروحدة = المستند.ردعنصربمعرف("وحدة%{مساروحدة.عووض('/'، '')}")؛
		ئدا عنصروحدة.ئسمصنف.يتضمن('بلاعرض'):
			#نريد ئضهاره
			عنصروحدة.ئسمصنف = عنصروحدة.ئسمصنف.عووض('بلاعرض'، 'بلوك')؛
			هدا.حالة.مفتوحات.ئدفع(مساروحدة)؛
			هدا.خدحالة({
				ضاهر: صحيح
			})؛
		وئلا:
			#نريد ئخفائه
			عنصروحدة.ئسمصنف = عنصروحدة.ئسمصنف.عووض('بلوك'، 'بلاعرض')؛
			عدد موضع = هدا.حالة.مفتوحات.ردموضع(مساروحدة)؛
			هدا.حالة.مفتوحات.ئجدل(موضع، 1)؛
			هدا.خدحالة({
				ضاهر: صحيح
			})؛
		تم
	وئلا:
		نصية مساره = مساروحدة؛
		ئدا مساروحدة.يبدئب('/'):
			مساره = مساروحدة.عووض('/'، '')؛
		تم
		#تعديل السياق
		سياق.خدحالة({
			مساروحدتحالية: مساروحدة
		})؛
		#نجلب بطاقات الوحدة
		مختطبطاقة[] بطاقات = ريتما مجالبطاقة.بطاقاتمنوحدة(قابمحلي، مساره)؛
		مكون مشهدمرشحات = المستند.ئستعلم((<مشهدمرشحات>))؛
		مشهدمرشحات.خدحالة({
			حالية: 0
		})؛
		مكون مشهدبطاقات = المستند.ئستعلم((<مشهدبطاقات>))؛
		مشهدبطاقات.خدحالة({
			بطاقات: بطاقات
		})؛
		#وحدة ملف
		هدا.خدحالة({
			مساروحدتحالية: مساروحدة،
			ضاهر: خطئ
		})؛
	تم
تم

ئعلن مشهدوحدات.حمملحالية () ك وعد منطق:
	ئدا هدا.حالة.مساروحدتحالية:
		ريتما هدا.عندنقروحدة()؛
	وئلا:
		ئرجع خطئ؛
	تم
تم

ئعلن مدخل ():
	عنصرمخصص.سججل('مشهدوحدات'، مشهدوحدات)؛
تم
